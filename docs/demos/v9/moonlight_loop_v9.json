{
  "graphVersion": 9,
  "description": "Moonlight opening arp loops N times via Counter+Switch, then exits to an outro Thought.",
  "expectedBehavior": "The Moonlight arpeggio plays in triplet 1/12, loops 4 times, then exits to Outro.",
  "successCriteria": [
    "Moonlight arp plays with piano preset",
    "Loop runs 4 iterations and exits",
    "Switch routes to exit branch after loop"
  ],
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "params": { "label": "Start" },
      "ui": { "x": 40, "y": 80 },
      "ports": {
        "inputs": [],
        "outputs": [{ "id": "out", "label": "Out", "type": "flow" }]
      }
    },
    {
      "id": "thought-moonlight",
      "type": "thought",
      "params": {
        "label": "Moonlight_Opening_Arp",
        "durationBars": 1,
        "key": "C# minor",
        "chordRoot": "C#",
        "chordQuality": "minor",
        "patternType": "arp-3-up",
        "rhythmGrid": "1/12",
        "syncopation": "none",
        "timingWarp": "none",
        "timingIntensity": 0,
        "registerMin": 48,
        "registerMax": 84,
        "instrumentSoundfont": "/assets/soundfonts/General-GS.sf2",
        "instrumentPreset": "gm_piano",
        "thoughtStatus": "draft",
        "thoughtVersion": 1
      },
      "ui": { "x": 240, "y": 60 },
      "ports": {
        "inputs": [{ "id": "in", "label": "In", "type": "flow", "required": true }],
        "outputs": [{ "id": "out", "label": "Out", "type": "flow" }]
      }
    },
    {
      "id": "counter-loop",
      "type": "counter",
      "params": { "label": "Loop Counter", "start": 0, "step": 1, "resetOnPlay": true },
      "ui": { "x": 440, "y": 60 },
      "ports": {
        "inputs": [{ "id": "in", "label": "In", "type": "flow", "required": true }],
        "outputs": [{ "id": "out", "label": "Out", "type": "flow" }]
      }
    },
    {
      "id": "switch-loop",
      "type": "switch",
      "params": {
        "label": "Loop / Exit",
        "mode": "first",
        "defaultBranch": "default",
        "branches": [
          {
            "id": "branch-1",
            "label": "Loop",
            "condition": { "type": "counter", "counterId": "counter-loop", "op": "<=", "value": 4 }
          }
        ]
      },
      "ui": { "x": 640, "y": 60 },
      "ports": {
        "inputs": [{ "id": "in", "label": "In", "type": "flow", "required": true }],
        "outputs": [
          { "id": "branch-1", "label": "Loop", "type": "flow" },
          { "id": "default", "label": "Exit", "type": "flow" }
        ]
      }
    },
    {
      "id": "thought-outro",
      "type": "thought",
      "params": {
        "label": "Moonlight_Exit",
        "durationBars": 1,
        "key": "C# minor",
        "chordRoot": "C#",
        "chordQuality": "minor",
        "patternType": "arp-3-down",
        "rhythmGrid": "1/12",
        "syncopation": "none",
        "timingWarp": "none",
        "timingIntensity": 0,
        "registerMin": 48,
        "registerMax": 84,
        "instrumentSoundfont": "/assets/soundfonts/General-GS.sf2",
        "instrumentPreset": "gm_piano",
        "thoughtStatus": "draft",
        "thoughtVersion": 1
      },
      "ui": { "x": 840, "y": 140 },
      "ports": {
        "inputs": [{ "id": "in", "label": "In", "type": "flow", "required": true }],
        "outputs": [{ "id": "out", "label": "Out", "type": "flow" }]
      }
    }
  ],
  "edges": [
    {
      "id": "edge-start-moonlight",
      "from": { "nodeId": "start-1", "portId": "out" },
      "to": { "nodeId": "thought-moonlight", "portId": "in" }
    },
    {
      "id": "edge-moonlight-counter",
      "from": { "nodeId": "thought-moonlight", "portId": "out" },
      "to": { "nodeId": "counter-loop", "portId": "in" }
    },
    {
      "id": "edge-counter-switch",
      "from": { "nodeId": "counter-loop", "portId": "out" },
      "to": { "nodeId": "switch-loop", "portId": "in" }
    },
    {
      "id": "edge-switch-loop",
      "from": { "nodeId": "switch-loop", "portId": "branch-1" },
      "to": { "nodeId": "thought-moonlight", "portId": "in" }
    },
    {
      "id": "edge-switch-exit",
      "from": { "nodeId": "switch-loop", "portId": "default" },
      "to": { "nodeId": "thought-outro", "portId": "in" }
    }
  ],
  "selection": { "nodes": [], "edges": [] },
  "viewport": { "x": 0, "y": 0, "zoom": 1 }
}
